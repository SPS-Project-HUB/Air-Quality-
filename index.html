<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESP32 Air Quality Monitor — Live</title>
  <style>
    body { font-family: system-ui; background:#f7f8fb; color:#111; padding:24px; margin:0; }
    .card { background:#fff; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.05); padding:24px; max-width:720px; margin:auto; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-top:14px; }
    .box { background:#f9fafc; padding:16px; border-radius:10px; text-align:center; }
    .big { font-size:1.6rem; font-weight:600; }
    #log { max-height:200px; overflow:auto; background:#f0f0f0; margin-top:14px; padding:8px; border-radius:8px; font-size:0.9rem; }
    footer { text-align:center; color:#777; font-size:0.85rem; margin-top:18px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ESP32 Air Quality Monitor (Live)</h1>
    <div id="status">Connecting to Firebase…</div>

    <div class="grid">
      <div class="box">
        <div>Temperature</div>
        <div id="temp" class="big">— °C</div>
      </div>
      <div class="box">
        <div>Humidity</div>
        <div id="hum" class="big">— %</div>
      </div>
      <div class="box">
        <div>MQ-2 (Raw ADC)</div>
        <div id="mq2" class="big">—</div>
      </div>
    </div>

    <div id="log">
      <strong>Realtime updates:</strong>
      <div id="events"></div>
    </div>

    <footer>Data from your Firebase Realtime DB path: <code>/AirQualityData</code></footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD8p71XKRrFnQ6BOXVSMnh9UfvhqjSoJiE",
      authDomain: "air-quality-61a68.firebaseapp.com",
      databaseURL: "https://air-quality-61a68-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "air-quality-61a68",
      storageBucket: "air-quality-61a68.firebasestorage.app",
      messagingSenderId: "681238979785",
      appId: "1:681238979785:web:b9a668b40b75610f519918"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const refPath = ref(db, "/AirQualityData");

    const tempEl = document.getElementById("temp");
    const humEl = document.getElementById("hum");
    const mq2El = document.getElementById("mq2");
    const statusEl = document.getElementById("status");
    const eventsEl = document.getElementById("events");

    function time() {
      return new Date().toLocaleString();
    }

    onValue(refPath, (snapshot) => {
      const val = snapshot.val();
      if (!val) {
        statusEl.textContent = "No data found at /AirQualityData";
        return;
      }

      const t = val.temperature ?? "—";
      const h = val.humidity ?? "—";
      const g = val.gas_level ?? "—";

      tempEl.textContent = t + " °C";
      humEl.textContent = h + " %";
      mq2El.textContent = g;
      statusEl.textContent = "Connected — last update: " + time();

      const line = document.createElement("div");
      line.textContent = `[${time()}] Temp:${t} Hum:${h} MQ2:${g}`;
      eventsEl.prepend(line);
      while (eventsEl.childElementCount > 40) eventsEl.removeChild(eventsEl.lastChild);
    });
  </script>
</body>
</html>
